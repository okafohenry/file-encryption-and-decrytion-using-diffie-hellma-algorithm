<!DOCTYPE html>
<html>
    <head>        
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta http-equiv="X-UA-Compatible" content="ie=edge">
        <title>Encryption and Decryption of data exchange files</title>
        <link rel="stylesheet" href="globalStyle.css" >
        <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/1.10.100/pdf.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.6.347/pdf.worker.entry.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/1.10.100/pdf.worker.min.js"></script>
    </head>
    <body>
        <header>
            <center>
                <nav>
                    <ul>
                        <li>
                            <a href="#" class="selected">Sender</a>
                        </li>
                        <li>
                            <a href="reciever.html" id="receiver-link" target="_blank"> Receiver</a>
                        </li>
                    </ul>
                </nav>
            </center>            
        </header>
        
        <main class="grid-container">
            <section>
                <input type="file" accept=".pdf" id="file-id" name="file_name" class="file_" onchange="ExtractText();"> 

                <input type="text" id="file-upload" class="file-upload" placeholder=".pdf file only" disabled />

                <label class="upload-btn" onclick="triggerUploadBtn()">choose file</label>
                <br/><br/>         
                <div class="output" id="output" ></div>
                <br/><br/>
                <input type="button" 
                    value="Encrypt File" 
                    id="encrypt-btn" 
                    class="encrypt-btn" 
                    onclick="showSenderKeyConfirm()" 
                    />  
            </section>
                     
            <!-- pop ups  -->

            <section>
                <div class="key-confirm-popup-overlay" id="key-confirm-popup-overlay">
                    <label class="close-popup" onclick="closePopup('key-confirm-popup-overlay')">X</label>
                    <form class="popup">
                        <div>
                            <p class="error" id="error"></p>
                            <input 
                                type="number" 
                                max="17" 
                                placeholder="Enter Private Key"
                                class="private_number"
                                id="private-number"/>
                            <br/><br/>
                            <label>private key:</label><p class="" id="display-private-key"></p> <br/>
                            <div class="confirm-generate-container">
                                <input type="button" value="Confirm" class="confirm-btn" onclick="encryptText()" />
                                <input type="button" value="Generate key" class="generate-private-key-btn" onclick="showGenPrivateKey()">
                            </div>
                            
                        </div>
                    </form>
                </div>
                
                <div class="generate-key-popup-overlay" id="generate-key-popup-overlay">                    
                    <label class="close-popup" onclick="closePopup('generate-key-popup-overlay')">X</label>
                    <form class="popup">
                            <p class="privateNumber_error" id="privateNumber_error"></p>
                            <input 
                                type="number" 
                                max="17" 
                                placeholder="Enter Private Number"
                                class="private_number"
                                id="sender-private-number"/>

                            <input 
                                type="button"  
                                value="Generate Public Key"
                                class="generate-public-key-btn"  
                                onclick="generateSenderPublicKey()" />

                            <br/><br/>
                            <label>public key: </label><span class="" id="display-receiver-public-key"></span> 
                            <p id="sender-pk-container"></p>
                            <br/> 
                            <input 
                                type="button"
                                value="Generate Private Key"
                                class="generate-private-key-btn2"
                                onclick="generateSenderPrivateKey()" />
                            <br/><br/>
                            <label>private key: </label><span class="" id="display-sender-private-key"></span>
                    </form>                
                </div>
            </section>             
        </main>  
        
        <script src="scripts.js"></script>    
        <script>
            const generateSenderPublicKey = () => {  
                let result;
                let private_number = document.getElementById("sender-private-number").value; 
                if(private_number) {                     
                    //display loading icon while reciever public key is being fetched
                    document.getElementById('display-receiver-public-key').innerHTML = "loading...";

                    result = Math.pow(3,private_number) % 17;  
                    
                    const items = JSON.parse(window.localStorage.getItem('data'));
                    items.senderPublicKey = result;
                    window.localStorage.setItem('data', JSON.stringify(items));

                    
                    //retrieve data from localStorage and display on P tag after 5 seconds
                    setTimeout("retrieveReceiverData()", 3500);
                }else{
                    document.getElementById('privateNumber_error').innerHTML = "Ensure that Private number box is not empty!";
                    setTimeout(() => {document.getElementById('privateNumber_error').innerHTML = ""}, 5000);
                }
            }

            //retrieve sender data from localStorage and display in index file (p tag) 
            const retrieveReceiverData = () => {
                const items = JSON.parse(window.localStorage.getItem('data'));
                const receiverKey = items.receiverPublicKey;
                console.log(receiverKey);

                document.getElementById('display-receiver-public-key').innerHTML = receiverKey;
            }
        </script> 
    </body>
</html>